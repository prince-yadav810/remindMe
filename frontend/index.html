<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>remindME - AI Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link class="image" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        body { 
            background-color: #1f1e1d;
            color: #e8e8e3;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        .container {
            display: flex;
            height: 100vh;
            flex-direction: row-reverse; /* This moves sidebar to right */
        }

        /* Sidebar - Now on the right */
        .sidebar {
            min-width: 280px;
            background-color: #222121;
            padding: 16px;
            transition: min-width 0.3s ease;
            position: relative;
            z-index: 2;
            order: 2;
            border-left: 1px solid #3a3a38;
            box-sizing: border-box; /* Ensure consistent width calculation */
        }

        .sidebar.collapsed {
            min-width: 68px;
            transition: min-width 0.3s ease;
        }

        .sidebar.hide {
            min-width: 0px;
            transition: min-width 0.3s ease;
        }

        .sidebar.hoverSidebar {
            position: absolute;
            width: 80px;
            transition: min-width 0.3s ease;
            background-color: #262624;
            top: 0;
            bottom: 0;
            right: 0;
            z-index: 5;
            border-left: 1px solid #3a3a38;
        }

        .sidebar.hoverSidebar-hide {
            width: 0px;
            transition: min-width 0.3s ease;
        }

        /* Updated sidebar-column to cover full width */
        .sidebar-column {
            width: 100%;
            margin-bottom: 16px;
            padding: 0; /* Remove any padding that might cause width issues */
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin-bottom: 24px;
            width: 100%;
            transition: width 0.2s;
            padding: 0; /* Remove padding */
        }

        .sidebar-header h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            color: #e8e8e3;
            font-family: 'Inter', sans-serif;
        }

        .toggle-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 20px;
            margin-right: 8px;
            cursor: pointer;
            transition: opacity 0.3s ease;
            z-index: 10;
            display: block;
            color: #b8b8b3;
        }

        .toggle-btn:hover {
            color: #e8e8e3;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .sidebar ul li {
            margin-bottom: 10px;
            transition: opacity 0.3s ease;
        }

        .sidebar ul li a {
            display: flex;
            align-items: center;
            color: #b8b8b3;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 400;
            margin-bottom: 2px;
        }

        .sidebar ul li a:hover {
            background-color: #3a3a38;
            color: #e8e8e3;
        }

        .sidebar ul li a:active,
        .sidebar ul li a.active {
            background-color: #c96342;
            color: #ffffff;
        }

        .sidebar ul li a i {
            margin-right: 12px;
            font-size: 16px;
            transition: margin-right 0.3s ease;
            width: 16px;
            text-align: center;
        }

        /* Sidebar content styling to ensure full width */
        .sidebar-content {
            width: 100%;
            padding: 0;
            margin: 0;
        }

        /* Time Display Styles - full width */
        .time-display {
            background-color: #213031;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            text-align: center;
            width: 100%;
            box-sizing: border-box; /* Ensure padding is included in width */
        }

        .current-time {
            font-size: 28px;
            font-weight: 600;
            color: #e8e8e3;
            font-family: 'Inter', sans-serif;
            margin-bottom: 8px;
        }

        .current-date {
            font-size: 14px;
            color: #b8b8b3;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
        }

        /* Reminder Section Styles - full width */
        .reminder-section {
            flex: 1;
            margin-bottom: 20px;
            width: 100%;
            padding: 0; /* Remove any padding */
            box-sizing: border-box; /* Ensure proper width calculation */
        }

        .reminder-title {
            font-size: 16px;
            font-weight: 600;
            color: #e8e8e3;
            margin-bottom: 16px;
            font-family: 'Inter', sans-serif;
        }

        .reminder-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 4px;
        }

        .reminder-list::-webkit-scrollbar {
            width: 4px;
        }

        .reminder-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .reminder-list::-webkit-scrollbar-thumb {
            background: #3a3a38;
            border-radius: 2px;
        }

        .reminder-item {
            background-color: #222121;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
        }

        .reminder-item:hover {
            background-color: #213031;
            border-color: #4a4a48;
        }

        .reminder-time {
            font-size: 12px;
            color: #4accd1;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
        }

        .reminder-date {
            font-size: 11px;
            color: #8a8a88;
            font-weight: 400;
            font-family: 'Inter', sans-serif;
        }

        .reminder-text {
            font-size: 13px;
            color: #e8e8e3;
            line-height: 1.4;
            font-family: 'Inter', sans-serif;
            margin-top: 2px;
        }

        .reminder-description {
            font-size: 12px;
            color: #8a8a88;
            margin-top: 4px;
            font-family: 'Inter', sans-serif;
        }

        .no-reminders {
            text-align: center;
            padding: 24px;
            color: #8a8a88;
        }

        .no-reminders i {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        .no-reminders p {
            font-size: 13px;
            margin: 0;
            font-family: 'Inter', sans-serif;
        }

        /* Action Buttons */
        .sidebar-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: absolute;
            bottom: 16px;
            left: 16px;
            right: 16px;
            padding-top: 16px;
            border-top: 1px solid #3a3a38;
        }

        .action-btn {
            background-color: #0f0f0f;
            border: none;
            color: #e8e8e3;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn:hover {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        .action-btn:active {
            background-color: #2a2a2a;
        }

        .action-btn i {
            font-size: 12px;
        }

        /* Collapsed sidebar styles */
        .sidebar.collapsed ul li a i {
            margin-right: 0;
        }

        .sidebar.collapsed ul li a .sidebar-text {
            display: none;
        }

        .sidebar.collapsed .sidebar-content {
            display: none;
        }

        /* Updated collapsed sidebar actions to show icons */
        .sidebar.collapsed .sidebar-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: absolute;
            bottom: 16px;
            left: 8px;
            right: 8px;
            padding-top: 16px;
            border-top: 1px solid #3a3a38;
        }

        .sidebar.collapsed .action-btn {
            background-color: #0f0f0f;
            padding: 12px;
            border-radius: 8px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar.collapsed .action-btn span {
            display: none;
        }

        .sidebar.collapsed .action-btn i {
            font-size: 16px;
            margin: 0;
        }

        .sidebar.collapsed .toggle-btn {
            display: block;
        }

        /* Main Content - Now on the left */
        main {
            flex-grow: 2;
            flex-grow: none;
            overflow: hidden;
            padding: 0px 0px 0px 0px;
            position: relative;
            display: flex;
            flex-direction: column;
            order: 1; /* Ensure main content stays on left */
        }

        .chat-container {
            display: flex;
            position: relative;
            flex-direction: column;
            background-color: #2A2A2A;
            margin: 0;
            border-radius: 0;
            margin-bottom: 0px;
            height: 100vh;
            overflow-y: scroll;
            overflow-x: hidden; 
            padding-bottom: 160px; /* Increased padding to prevent overlap with typing box */
            border-right: 1px solid #3a3a38;
        }

        .chat-container.scrollable {
           overflow-y: scroll;
           width: 12px;
        }

        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-track {
            background-color: transparent;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background-color: #3a3a38;
            border-radius: 3px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background-color: #4a4a48;
        }

        .input-box {
            position: relative;
            z-index: 2;
        }

        .chat-window {
            display: flex;
            flex-direction: column;
            background-color: transparent;
            height: 100%;
            overflow-y: hidden;
            align-self: center;
            width: 650px;
            align-items: left;
        }

        .message {
            display: inline-block;
            margin-bottom: 16px;
            font-family: 'Libre Baskerville', Georgia, serif;
            font-size: 14px;
            line-height: 1.6;
            margin-left: 20px;
            margin-right: 20px;
            opacity: 1;
            overflow: hidden;
            color: #e8e8e3;
        }

        .typing-box-container {
            display: flex;
            flex-direction: column;
            z-index: 2;
            justify-content: center;
            justify-self: center;
            justify-items: center;
            align-items: center;
            margin-top: auto;
            align-content: center;
            align-tracks:center;
            align-self: center;
            width: 800px;
            padding: 0 1rem;
            box-sizing: border-box;
            margin-top: calc(0vh - 56px);
            margin-bottom: 20px; /* Added margin to create space from bottom */
            position: fixed;
            bottom: 0;
            max-width: 100%;
            flex-grow: 20%;
            justify-content: space-between;
        }

        .sidebar.collapsed + main .typing-box-container {
            width: calc(100% - 68px);
        }

        .sidebar.hide {
            width: 0px;
            padding: 0px;
        }

        .sidebar.hide ul li a {
            opacity: 0;
        }

        .flex-Typing-Box {
            display: flex;
            padding: 5px;
            width: 100%;
            align-items: center;
            align-self: center;
        }

        .input-box {
            display: flex;
            align-items: flex-end;
            justify-content: right;
            background-color: #1f1e1d;
            padding: 12px 16px;
            border-radius: 12px;
            justify-self: right;
            width: 88%;
            z-index: 2;
            border: 1px solid #3a3a38;
            transition: border-color 0.2s ease;
        }

        .input-box:focus-within {
            border-color: #238588;
        }

        .sidebar.collapsed .input-box {
            justify-content: flex-end;
            width: calc(10% - 182px);
            margin-left: auto;
        }

        .input-box input {
            flex-grow: 1;
            background-color: transparent;
            border: none;
            outline: none;
            color: #fff;
            padding: 5px;
            font-family: 'Roboto', sans-serif;
            resize: vertical;
            overflow-y: auto;
            max-height: 8em;
            z-index: 2;
        }

        .input-box button {
            background-color: #238588;
            color: #ffffff;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 14px;
        }

        .input-box button:hover {
            background-color: #238588;
        }

        .input-box button:disabled {
            background-color: #4a4a48;
            color: #8a8a88;
            cursor: not-allowed;
        }

        .input-box button i {
            font-size: 16px;
            z-index: 2;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background-color: #2A2A2A;
            position: relative;
            z-index: 2;
            border-bottom: 1px solid #3a3a38;
        }

        .header-left {
            color: #e8e8e3;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            font-family: 'Inter', sans-serif;
        }

        .header-right .share-button {
            background-color: #238588;
            border: none;
            color: #ffffff;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .header-right .share-button:hover {
            background-color: #4accd1;
        }

        .message-Input {
          font-size: 18px;
          margin-bottom: 3px;
          margin-left: 3px;
        }

        .div-picture-Button {
            display: flex;
            align-items: middle;
            margin-left: 7px;
            margin-right: 10px;
            z-index: 2;
        }

        .picture-Button {
            border: none;
            color: #b8b8b3;
            background-color: #1f1e1d;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 12px;
            border-radius: 6px;
            height: 48px;
            width: 48px;
            z-index: 2;
            border: 1px solid #3a3a38;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .picture-Button:hover {
            background-color: #3a3a38;
            color: #e8e8e3;
            border-color: #4a4a48;
        }

        .picture-Button:active {
            background-color: #c96342;
            color: #ffffff;
            border-color: #238588;
        }

        .instructions {
            align-items: center;
            align-self: center;
            font-size: 12px;
            color: #8a8a88;
            display: block;
            z-index: 2;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
        }

        .div-instructions {
            display: block;
            flex-wrap: wrap;
            margin-top: 3px;
            text-align: center;
            z-index: 2;
        }

        .fade-container {
            position: relative;
        }

        .fade-container::before {
            content: "";
            position: absolute;
            left: 0;
            width: 100%;
            height: 160px;
            background: linear-gradient(to top, #1a1a1a 40%, transparent);
            bottom: 0;
            z-index: 1;
        }

        .input-box, .picture-Button {
            position: relative;
            z-index: 2;
        }

        .show-response {
            display:flex;
            flex-direction: column;
        }

        .chat-place {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow:hidden;
            align-self:center;
            width: 700px;
            align-items: left;
            overflow-y: auto;
        }

        .scrollbar {
            display: flex;
            position: absolute;
            top: 0;
            right: 0;
            width: 20px;
            height: 100%;
            background-color: #ccc;
        }

        .additional-content {
            display: flex;
            align-items: center;
            margin-right: 10px;
            display: inline-block;
            object-position: top;
        }

        .logo {
            width: 34px;
            height: 34px;
            margin-right: 0px;
            display: inline-block;
            object-position: top;
            vertical-align:top;
            border-radius: 50px;
        }

        .message-container {
            display: flex;
            position: relative;
            transition: opacity 0.2s;
            flex-direction: row;
            align-items: flex-start;
            margin-bottom: 20px; /* Increased margin between messages */
            align-self:center;
            width: 70%;
            max-width: 700px;
            opacity: 0;
            overflow-wrap: break-word;
        }

        .dropdown-logo {
            display: flex;
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }

        .input-box div[contenteditable] {
            flex-grow: 1;
            background-color: transparent;
            border: none;
            outline: none;
            color: #e8e8e3;
            padding: 8px 12px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            overflow: auto;
            min-height: 20px;
            max-height: 120px;
            z-index: 2;
            word-wrap: break-word;
        }

        .input-box div[contenteditable]:empty::before {
            content: attr(data-placeholder);
            color: #8a8a88;
            pointer-events: none;
            font-style: normal;
        }

        /* Welcome message with Libre Baskerville */
        .welcome-greeting {
            font-family: 'Libre Baskerville', Georgia, serif;
            font-size: 32px;
            font-weight: 400;
            color: #e8e8e3;
            text-align: center;
            margin-bottom: 32px;
        }

        .welcome-greeting .icon {
            color: #c96342;
            margin-right: 16px;
            font-size: 24px;
        }

        .sidebar.collapsed h3 {
            display: none;
            opacity: 0.5;
            transition: opacity 0.18s ease;
        }

        .mobile-container {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 10;
            flex-direction: column;
        }

        .mobileDiv ul {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            justify-content: space-around;
            list-style-type: none;
            padding: 0;
            margin: 0;
            height: 4pc;
        }

        .mobileDiv ul li {
            display: flex;
            flex-direction: column;
            text-align: center;
            justify-self:top;
            justify-content: end; 
        }

        .mobileDiv {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #262624;
            padding: 12px;
            z-index: 10;
            border-top: 1px solid #3a3a38;
        }

        .mobileDiv ul li a {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #b8b8b3;
            text-decoration: none;
            align-items: top;
            align-self: center;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .mobileDiv ul li a i {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .mobileDiv ul li a .sidebar-text {
            font-size: 11px;
            font-weight: 400;
            font-family: 'Inter', sans-serif;
        }

        .mobileDiv ul li a:hover,
        .mobileDiv ul li a.active {
            background-color: #c96342;
            color: #ffffff;
            transform: none;
        }

        .div-typing-box-container {
            display: flex;
            justify-content: center;
            width: 100%;
        }

        /* Loading indicator */
        .loading {
            display: none;
            color: #b8b8b3;
            font-style: normal;
            margin-left: 20px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            padding: 12px 0;
        }

        /* Chat message formatting styles - updated heading sizes */
        .message h3 {
            color: #4accd1 !important;
            font-weight: 600 !important;
            margin: 20px 0 12px 0 !important;
            font-size: 18px !important;
            font-family: 'Inter', sans-serif !important;
        }

        .message h4 {
            color: #e8e8e3 !important;
            font-weight: 500 !important;
            margin: 16px 0 8px 0 !important;
            font-size: 16px !important;
            font-family: 'Inter', sans-serif !important;
        }

        .message ul {
            margin: 12px 0 !important;
            padding-left: 20px !important;
            color: #e8e8e3 !important;
        }

        .message li {
            margin: 8px 0 !important;
            line-height: 1.6 !important;
        }

        .message li strong {
            color: #4accd1 !important;
            font-weight: 600 !important;
        }

        .message code {
            background-color: #3a3a38 !important;
            padding: 2px 6px !important;
            border-radius: 4px !important;
            font-family: 'JetBrains Mono', monospace !important;
            font-size: 13px !important;
            color: #e8e8e3 !important;
        }

        .message blockquote {
            border-left: 3px solid #c96342 !important;
            padding: 8px 16px !important;
            margin: 8px 0 !important;
            background-color: #2a2a28 !important;
            color: #e8e8e3 !important;
            font-style: italic !important;
        }

        .message em {
            color: #4accd1 !important;
            font-style: italic !important;
        }

        /* Formatted sections and special content */
        .message div[style*="background-color: #2a2a28"] {
            background-color: #2a2a28 !important;
            border-left: 3px solid #4accd1 !important;
            padding: 12px !important;
            margin: 8px 0 !important;
            border-radius: 4px !important;
            color: #e8e8e3 !important;
        }

        /* Table-like structures */
        .message div[style*="display: flex"] {
            display: flex !important;
            background-color: #2a2a28 !important;
            padding: 8px !important;
            margin: 4px 0 !important;
            border-radius: 4px !important;
        }

        .error-message {
            color: #ff6b6b;
            background-color: #2a1a1a;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 12px 20px;
            border-left: 3px solid #ff6b6b;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }

        /* Notification and Animation Styles */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .processing-reminder {
            position: relative;
            overflow: hidden;
        }
        
        .processing-reminder::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(74, 204, 209, 0.3), transparent);
            animation: slide 2s infinite;
        }
        
        @keyframes slide {
            0% { left: -100%; }
            100% { left: 100%; }
        }
    </style>
</head>
<body>
<div class="fade-container">
  <div class="container">
      <nav class="sidebar" id="sidebar">
          <!-- Toggle button positioned at top right -->
          <i class="fas fa-bars toggle-btn" onclick="toggleSidebar()"></i>
          
          <div class="sidebar-content">
              <div class="sidebar-column">
                  <div class="sidebar-header">
                      <h3 id="sidebar-header-text">Dashboard</h3>
                  </div>
              </div>
              
              <div class="sidebar-column">
                  <!-- Time Display Section -->
                  <div class="time-display">
                      <div class="current-time" id="currentTime">12:45 PM</div>
                      <div class="current-date" id="currentDate">Monday, Dec 23, 2024</div>
                  </div>
              </div>
              
              <div class="sidebar-column">
                  <!-- Reminder Section -->
                  <div class="reminder-section">
                      <h4 class="reminder-title">Today's Reminders</h4>
                      <div class="reminder-list" id="reminderList">
                          <div class="no-reminders">
                              <i class="fas fa-calendar-check"></i>
                              <p>No reminders for today</p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          
          <!-- Action Buttons at bottom -->
          <div class="sidebar-actions">
              <button class="action-btn" onclick="setReminder()">
                  <i class="fas fa-plus"></i>
                  <span>Set Reminder</span>
              </button>
              <button class="action-btn" onclick="viewHistory()">
                  <i class="fas fa-history"></i>
                  <span>View History</span>
              </button>
          </div>
      </nav>
    <div class="fade-container"></div>

    <main>
        <div id="content">
            <!-- Content will be dynamically loaded here -->
        </div>
        
      <div class="mobileDiv" id="mobileDiv">
        <ul>
          <li><a href="#chatBot"><i class="fas fa-home"></i><span class="sidebar-text">Chat</span></a></li>
              <li><a href="#explore"><i class="fas fa-compass"></i><span class="sidebar-text">Explore</span></a></li>
              <li><a href="#imageGenerator"><i class="fas fa-chart-bar"></i><span class="sidebar-text">Artifacts</span></a></li>
              <li><a href="#library"><i class="fas fa-cog"></i><span class="sidebar-text">Library</span></a></li>
        </ul>
      </div>
     </main> 
  </div>
 </div>

<script>
// Enhanced JavaScript for remindME with Clean Dual API System

// Session management
let sessionId = 'session-' + Date.now();
let isLoading = false;

// Time and Date functionality
function updateTimeDisplay() {
    const now = new Date();
    
    // Format time (12-hour format with AM/PM)
    const timeOptions = {
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
    };
    const timeString = now.toLocaleTimeString('en-US', timeOptions);
    
    // Format date
    const dateOptions = {
        weekday: 'long',
        month: 'short',
        day: '2-digit',
        year: 'numeric'
    };
    const dateString = now.toLocaleDateString('en-US', dateOptions);
    
    // Update DOM elements
    const timeElement = document.getElementById('currentTime');
    const dateElement = document.getElementById('currentDate');
    
    if (timeElement) timeElement.textContent = timeString;
    if (dateElement) dateElement.textContent = dateString;
}

// Update time every second
setInterval(updateTimeDisplay, 1000);
updateTimeDisplay(); // Initial call

// Load reminders from API with enhanced debugging
async function loadReminders() {
    try {
        console.log('=== Loading reminders from API ===');
        const response = await fetch('/api/reminders');
        const data = await response.json();
        
        console.log('Full API response:', data);
        
        // Use upcoming_reminders for sidebar (includes today + next 7 days)
        if (data.upcoming_reminders && data.upcoming_reminders.length > 0) {
            console.log(`Found ${data.upcoming_reminders.length} upcoming reminders:`, data.upcoming_reminders);
            displayReminders(data.upcoming_reminders);
        } else if (data.today_reminders && data.today_reminders.length > 0) {
            // Fallback to today's reminders only
            console.log(`Fallback: Found ${data.today_reminders.length} today's reminders:`, data.today_reminders);
            displayReminders(data.today_reminders);
        } else if (data.all_reminders) {
            // Last resort: filter all reminders for upcoming dates on frontend
            console.log('Filtering all reminders for upcoming dates on frontend...');
            const today = new Date();
            const nextWeek = new Date(today.getTime() + (7 * 24 * 60 * 60 * 1000));
            
            const upcomingReminders = data.all_reminders.filter(reminder => {
                if (!reminder.completed && reminder.date) {
                    const reminderDate = new Date(reminder.date);
                    console.log(`Comparing reminder date ${reminder.date} (${reminderDate.toDateString()}) with range ${today.toDateString()} to ${nextWeek.toDateString()}`);
                    return reminderDate >= today && reminderDate <= nextWeek;
                }
                return false;
            });
            console.log(`Filtered ${upcomingReminders.length} upcoming reminders:`, upcomingReminders);
            displayReminders(upcomingReminders);
        } else {
            console.log('No reminders data found in response');
            displayReminders([]);
        }
        console.log('=== Finished loading reminders ===');
    } catch (error) {
        console.error('Error loading reminders:', error);
    }
}

// Convert 24-hour time to 12-hour format
function formatTime12Hour(time24) {
    if (!time24) return 'All day';
    
    const [hours, minutes] = time24.split(':');
    const hour = parseInt(hours);
    const minute = minutes;
    const ampm = hour >= 12 ? 'PM' : 'AM';
    const hour12 = hour % 12 || 12;
    
    return `${hour12}:${minute} ${ampm}`;
}

// Format date for display
function formatDateForReminder(dateStr) {
    if (!dateStr) return '';
    
    const reminderDate = new Date(dateStr);
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    
    // Reset time to compare only dates
    const reminderDateOnly = new Date(reminderDate.getFullYear(), reminderDate.getMonth(), reminderDate.getDate());
    const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const tomorrowOnly = new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate());
    
    if (reminderDateOnly.getTime() === todayOnly.getTime()) {
        return 'Today';
    } else if (reminderDateOnly.getTime() === tomorrowOnly.getTime()) {
        return 'Tomorrow';
    } else {
        // Format as "Dec 25" or "Jan 1, 2025" if different year
        const options = reminderDate.getFullYear() !== today.getFullYear() 
            ? { month: 'short', day: 'numeric', year: 'numeric' }
            : { month: 'short', day: 'numeric' };
        return reminderDate.toLocaleDateString('en-US', options);
    }
}

// Display reminders in sidebar with new layout: TIME on left, DATE on right
function displayReminders(reminders) {
    console.log('=== Displaying reminders ===');
    console.log('Reminders to display:', reminders);
    
    const reminderList = document.getElementById('reminderList');
    const noReminders = reminderList.querySelector('.no-reminders');
    
    if (!reminderList) {
        console.error('reminderList element not found!');
        return;
    }
    
    // Clear existing reminders (except no-reminders message)
    const existingReminders = reminderList.querySelectorAll('.reminder-item');
    console.log(`Removing ${existingReminders.length} existing reminder items`);
    existingReminders.forEach(item => item.remove());
    
    if (!reminders || reminders.length === 0) {
        console.log('No reminders to display, showing no-reminders message');
        if (noReminders) {
            noReminders.style.display = 'block';
        }
        return;
    }
    
    // Hide no-reminders message
    if (noReminders) {
        noReminders.style.display = 'none';
        console.log('Hidden no-reminders message');
    }
    
    // Add reminders with new layout
    console.log(`Adding ${reminders.length} reminders to sidebar`);
    reminders.forEach((reminder, index) => {
        console.log(`Processing reminder ${index + 1}:`, reminder);
        
        const timeFormatted = formatTime12Hour(reminder.time);
        const dateFormatted = formatDateForReminder(reminder.date);
        
        console.log(`Formatted time: ${timeFormatted}, date: ${dateFormatted}`);
        
        const reminderItem = document.createElement('div');
        reminderItem.className = 'reminder-item';
        reminderItem.style.cssText = `
            background-color: #222121;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
        `;
        
        // Create header with time on left and date on right
        const headerDiv = document.createElement('div');
        headerDiv.style.cssText = `
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        `;
        
        const timeSpan = document.createElement('span');
        timeSpan.className = 'reminder-time';
        timeSpan.style.cssText = `
            font-size: 12px;
            color: #4accd1;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
        `;
        timeSpan.textContent = timeFormatted;
        
        const dateSpan = document.createElement('span');
        dateSpan.className = 'reminder-date';
        dateSpan.style.cssText = `
            font-size: 11px;
            color: #8a8a88;
            font-weight: 400;
            font-family: 'Inter', sans-serif;
        `;
        // Only show date if it's not "Today"
        dateSpan.textContent = dateFormatted !== 'Today' ? dateFormatted : '';
        
        headerDiv.appendChild(timeSpan);
        headerDiv.appendChild(dateSpan);
        
        // Create title
        const titleDiv = document.createElement('div');
        titleDiv.className = 'reminder-text';
        titleDiv.style.cssText = `
            font-size: 13px;
            color: #e8e8e3;
            line-height: 1.4;
            font-family: 'Inter', sans-serif;
            margin-top: 2px;
        `;
        titleDiv.textContent = reminder.title;
        
        // Add description if exists
        const descriptionDiv = document.createElement('div');
        if (reminder.description) {
            descriptionDiv.className = 'reminder-description';
            descriptionDiv.style.cssText = `
                font-size: 12px;
                color: #8a8a88;
                margin-top: 4px;
                font-family: 'Inter', sans-serif;
            `;
            descriptionDiv.textContent = reminder.description;
        }
        
        // Assemble the reminder item
        reminderItem.appendChild(headerDiv);
        reminderItem.appendChild(titleDiv);
        if (reminder.description) {
            reminderItem.appendChild(descriptionDiv);
        }
        
        // Add hover effect
        reminderItem.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#213031';
        });
        reminderItem.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '#222121';
        });
        
        // Add before the no-reminders div
        if (noReminders) {
            reminderList.insertBefore(reminderItem, noReminders);
        } else {
            reminderList.appendChild(reminderItem);
        }
        
        console.log(`Added reminder item to DOM: ${reminder.title}`);
    });
    
    console.log('=== Finished displaying reminders ===');
}

// Show processing animation in sidebar
function showReminderProcessingAnimation() {
    const reminderList = document.getElementById('reminderList');
    const noReminders = reminderList.querySelector('.no-reminders');
    
    // Create processing animation
    const processingItem = document.createElement('div');
    processingItem.className = 'reminder-item processing-reminder';
    processingItem.id = 'processing-reminder';
    processingItem.style.cssText = `
        background: linear-gradient(90deg, #213031, #2a3a3b, #213031);
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        border: 1px dashed #4accd1;
        opacity: 0.8;
    `;
    
    processingItem.innerHTML = `
        <div class="reminder-time">
            <i class="fas fa-circle-notch fa-spin" style="color: #4accd1; margin-right: 4px;"></i>
            Processing...
        </div>
        <div class="reminder-text">Creating your reminder...</div>
    `;
    
    // Hide no-reminders if visible
    if (noReminders && noReminders.style.display !== 'none') {
        noReminders.style.display = 'none';
    }
    
    // Add animation at the top
    if (noReminders) {
        reminderList.insertBefore(processingItem, noReminders);
    } else {
        reminderList.appendChild(processingItem);
    }
}

// Remove processing animation
function removeReminderProcessingAnimation() {
    const processingItem = document.getElementById('processing-reminder');
    if (processingItem) {
        processingItem.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => {
            if (processingItem.parentNode) {
                processingItem.parentNode.removeChild(processingItem);
            }
        }, 300);
    }
}

// Show notification
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        background-color: ${type === 'success' ? '#4accd1' : type === 'error' ? '#ff6b6b' : '#c96342'};
        color: white;
        border-radius: 8px;
        z-index: 1000;
        font-family: 'Inter', sans-serif;
        font-size: 14px;
        max-width: 300px;
        word-wrap: break-word;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        animation: slideIn 0.3s ease-out;
    `;
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Complete formatBotResponse function - Fixed BR issues
function formatBotResponse(text) {
    // Escape HTML to prevent injection
    let formatted = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    
    // Step 1: Handle bold headings with ** ** - must be at start of line or after whitespace
    formatted = formatted.replace(/(^|\s)\*\*([^*\n]+?)\*\*:?(\s|$)/gm, '$1<h3 style="color: #4accd1; font-weight: 600; margin: 20px 0 12px 0; font-size: 18px; font-family: \'Inter\', sans-serif;">$2</h3>$3');
    
    // Step 2: Handle headers with ## and ### - must be at start of line
    formatted = formatted.replace(/^###\s+(.+?)$/gm, '<h4 style="color: #e8e8e3; font-weight: 500; margin: 16px 0 8px 0; font-size: 16px; font-family: \'Inter\', sans-serif;">$1</h4>');
    formatted = formatted.replace(/^##\s+(.+?)$/gm, '<h3 style="color: #4accd1; font-weight: 600; margin: 20px 0 12px 0; font-size: 18px; font-family: \'Inter\', sans-serif;">$1</h3>');
    
    // Step 3: Handle bullet points - convert * items to proper list format
    let lines = formatted.split('\n');
    let inList = false;
    let processedLines = [];
    
    for (let i = 0; i < lines.length; i++) {
        let line = lines[i].trim();
        
        // Check if line starts with * followed by space (bullet point)
        if (/^\*\s+/.test(line)) {
            if (!inList) {
                processedLines.push('<ul style="margin: 12px 0; padding-left: 20px; color: #e8e8e3; list-style-type: disc;">');
                inList = true;
            }
            // Add list item - remove the * and space
            let listContent = line.substring(2).trim();
            // Handle bold text within list items only
            listContent = listContent.replace(/\*\*([^*]+?)\*\*/g, '<strong style="color: #4accd1;">$1</strong>');
            processedLines.push(`<li style="margin: 8px 0; line-height: 1.6; display: list-item;">${listContent}</li>`);
        } else {
            if (inList) {
                processedLines.push('</ul>');
                inList = false;
            }
            if (line.length > 0) {
                processedLines.push(line);
            } else if (!inList) {
                // Only add empty lines when not in a list and if the previous line wasn't empty
                if (processedLines.length > 0 && processedLines[processedLines.length - 1] !== '') {
                    processedLines.push('');
                }
            }
        }
    }
    
    // Close any remaining list
    if (inList) {
        processedLines.push('</ul>');
    }
    
    // Join lines with proper spacing
    formatted = processedLines.join('\n');
    
    // Step 4: Handle numbered lists - must be at start of line
    formatted = formatted.replace(/^(\d+\.\s+)(.+?)$/gm, '<div style="margin: 8px 0; color: #e8e8e3;"><span style="color: #c96342; font-weight: 600;">$1</span>$2</div>');
    
    // Step 5: Handle emphasis with single asterisks - but not part of ** or at word boundaries
    formatted = formatted.replace(/(?<!\*)\*([^*\s][^*]*?[^*\s])\*(?!\*)/g, '<em style="color: #c96342; font-style: italic;">$1</em>');
    
    // Step 6: Handle code blocks with backticks - single words or phrases
    formatted = formatted.replace(/`([^`\n]+?)`/g, '<code style="background-color: #3a3a38; padding: 2px 6px; border-radius: 4px; font-family: \'JetBrains Mono\', monospace; font-size: 13px; color: #e8e8e3;">$1</code>');
    
    // Step 7: Handle special sections (bracketed content) - only complete brackets
    formatted = formatted.replace(/\[([^\[\]]+?)\]/g, '<div style="background-color: #2a2a28; border-left: 3px solid #c96342; padding: 12px; margin: 12px 0; border-radius: 4px; color: #e8e8e3;">$1</div>');
    
    // Step 8: Handle quotations - lines starting with >
    formatted = formatted.replace(/^&gt;\s*(.+?)$/gm, '<blockquote style="border-left: 3px solid #c96342; padding: 8px 16px; margin: 12px 0; background-color: #2a2a28; color: #e8e8e3; font-style: italic;">$1</blockquote>');
    
    // Step 9: Handle line breaks more selectively - FIXED VERSION
    // Only convert double newlines to paragraph breaks, and avoid breaks around HTML elements
    formatted = formatted.replace(/\n\s*\n+/g, '</p><p>'); // Convert double newlines to paragraph breaks
    formatted = '<p>' + formatted + '</p>'; // Wrap in paragraph tags
    
    // Clean up empty paragraphs and fix paragraph formatting
    formatted = formatted.replace(/<p>\s*<\/p>/g, ''); // Remove empty paragraphs
    formatted = formatted.replace(/<p>\s*(<\/?(ul|li|h[3-4]|div|blockquote))/g, '$1'); // Remove paragraph tags before block elements
    formatted = formatted.replace(/(<\/?(ul|li|h[3-4]|div|blockquote)[^>]*>)\s*<\/p>/g, '$1'); // Remove paragraph tags after block elements
    formatted = formatted.replace(/<p>\s*(<\/?(ul|li|h[3-4]|div|blockquote)[^>]*>)/g, '$1'); // Clean up more cases
    formatted = formatted.replace(/(<\/?(ul|li|h[3-4]|div|blockquote)[^>]*>)\s*<p>/g, '$1'); // Clean up more cases
    
    // Step 10: Clean up any remaining issues
    formatted = formatted.replace(/\n/g, ' '); // Convert remaining single newlines to spaces
    formatted = formatted.replace(/\s+/g, ' '); // Collapse multiple spaces
    formatted = formatted.replace(/(<\/p>)\s*(<p>)/g, '$1$2'); // Remove spaces between paragraphs
    
    return formatted.trim();
}

// Enhanced message sending with dual API processing
function sendMessage() {
    var messageInput = document.getElementById('messageInput');
    var messageText = messageInput.textContent.trim();
    
    if (messageText !== '' && !isLoading) {
        isLoading = true;
        var chatContainer = document.querySelector('.chat-container');

        console.log('User message:', messageText);

        // Create user message
        var message = `<strong>You:</strong><br>${messageText.replace(/\n/g, "<br>")}`;

        // Create a container div for the message
        var messageContainer = document.createElement('div');
        messageContainer.classList.add('message-container');

        // Create a div for the additional content (user avatar)
        var additionalContent = document.createElement('div');
        additionalContent.classList.add('additional-content');

        // Create the user avatar
        var userAvatar = document.createElement('div');
        userAvatar.style.cssText = `
            width: 34px; height: 34px; border-radius: 6px; 
            background: #3a3a38; color: #e8e8e3; 
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; margin-right: 0px; font-size: 14px;
            font-family: 'Inter', sans-serif;
        `;
        userAvatar.textContent = 'You';
        additionalContent.appendChild(userAvatar);
        
        // Create the message div
        var newMessageDiv = document.createElement('div');
        newMessageDiv.classList.add('message');
        newMessageDiv.innerHTML = message;

        // Append elements
        messageContainer.appendChild(additionalContent);
        messageContainer.appendChild(newMessageDiv);
        chatContainer.appendChild(messageContainer);

        // Show message
        setTimeout(function() {
            messageContainer.style.opacity = 1;
        }, 100);

        // Clear input
        messageInput.textContent = '';

        // Show loading indicator
        var loadingDiv = document.createElement('div');
        loadingDiv.classList.add('loading');
        loadingDiv.innerHTML = '<i class="fas fa-circle-notch fa-spin" style="margin-right: 8px; color: #c96342;"></i>Analyzing with AI...';
        chatContainer.appendChild(loadingDiv);
        loadingDiv.style.display = 'block';

        // Scroll to bottom
        chatContainer.scrollTop = chatContainer.scrollHeight;

        // Send to enhanced API
        fetch('/api/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                message: messageText,
                session_id: sessionId
            })
        })
        .then(response => response.json())
        .then(data => {
            // Remove loading indicator
            loadingDiv.remove();
            
            if (data.error) {
                throw new Error(data.error);
            }

            console.log('API Response:', data);

            // Create bot response with formatting
            var formattedResponse = formatBotResponse(data.message || data.response);
            var botMessage = `<strong>remindME:</strong><br>${formattedResponse}`;
            
            // Check if trigger was activated
            if (data.trigger) {
                console.log('Trigger activated - processing reminder...');
                
                // Show processing animation in sidebar
                showReminderProcessingAnimation();
                
                // Show trigger indicator in chat
                botMessage += '<br><div class="status-indicator trigger" style="background-color: #c96342; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin: 8px 0; display: inline-block;"><i class="fas fa-cogs fa-spin"></i> Processing reminder...</div>';
            }
            
            var botMessageContainer = document.createElement('div');
            botMessageContainer.classList.add('message-container');

            var botAdditionalContent = document.createElement('div');
            botAdditionalContent.classList.add('additional-content');

            // Bot avatar
            var botAvatar = document.createElement('div');
            botAvatar.style.cssText = `
                width: 34px; height: 34px; border-radius: 6px; 
                background: #238588; color: #ffffff;
                display: flex; align-items: center; justify-content: center;
                font-weight: bold; margin-right: 0px; font-size: 16px;
            `;
            botAvatar.innerHTML = '<i class="fas fa-robot"></i>';
            botAdditionalContent.appendChild(botAvatar);

            var botMessageDiv = document.createElement('div');
            botMessageDiv.classList.add('message');
            botMessageDiv.innerHTML = botMessage;

            botMessageContainer.appendChild(botAdditionalContent);
            botMessageContainer.appendChild(botMessageDiv);
            chatContainer.appendChild(botMessageContainer);

            // Show bot message
            setTimeout(function() {
                botMessageContainer.style.opacity = 1;
            }, 100);

            // Handle reminder creation with better validation
            if (data.trigger) {
                // We know a trigger was detected, now check if reminder was actually created
                if (data.reminder_created) {
                    console.log('Reminder successfully created:', data.reminder_created);
                    
                    setTimeout(() => {
                        removeReminderProcessingAnimation();
                        
                        // Force reload reminders from server
                        loadReminders().then(() => {
                            console.log('Reminders reloaded successfully');
                        });
                        
                        // Show success notification
                        showNotification(`Reminder created: ${data.reminder_created.title}`, 'success');
                        
                        // Update the status indicator in chat
                        const statusIndicator = botMessageDiv.querySelector('.status-indicator.trigger');
                        if (statusIndicator) {
                            statusIndicator.innerHTML = '<i class="fas fa-check"></i> Reminder created successfully!';
                            statusIndicator.style.backgroundColor = '#4accd1';
                        }
                        
                    }, 800);
                    
                } else {
                    // Trigger was detected but reminder creation failed
                    console.log('Trigger detected but reminder creation failed');
                    setTimeout(() => {
                        removeReminderProcessingAnimation();
                        showNotification('Could not create reminder, please try again with more specific details', 'error');
                        
                        // Show format help after a short delay
                        setTimeout(() => {
                            showReminderFormatHelp();
                        }, 1000);
                        
                        // Update the status indicator in chat
                        const statusIndicator = botMessageDiv.querySelector('.status-indicator.trigger');
                        if (statusIndicator) {
                            statusIndicator.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Could not create reminder';
                            statusIndicator.style.backgroundColor = '#ff6b6b';
                        }
                    }, 1500);
                }
            }

            // Scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        })
        .catch(error => {
            // Remove loading indicator
            loadingDiv.remove();
            
            // Remove processing animation if it exists
            removeReminderProcessingAnimation();
            
            // Show error message
            var errorDiv = document.createElement('div');
            errorDiv.classList.add('error-message');
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Error: ${error.message}`;
            chatContainer.appendChild(errorDiv);
            
            console.error('Error:', error);
            showNotification('Error processing message', 'error');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        })
        .finally(() => {
            isLoading = false;
        });
    }
}

// Enhanced reminder creation from sidebar
function setReminder() {
    const reminderText = prompt("Enter your reminder:");
    const reminderTime = prompt("Enter time (e.g., 3:30 PM or 15:30):");
    const reminderDate = prompt("Enter date (YYYY-MM-DD) or leave empty for today:");
    
    if (reminderText && reminderTime) {
        const today = new Date().toISOString().split('T')[0];
        const finalDate = reminderDate || today;
        
        // Convert 12-hour format to 24-hour if needed
        const time24 = convertTo24Hour(reminderTime);
        
        createReminderAPI(reminderText, time24, finalDate);
    }
}

// Convert 12-hour time to 24-hour format
function convertTo24Hour(time12) {
    if (!time12) return null;
    
    // If already in 24-hour format, return as is
    if (!/AM|PM/i.test(time12)) {
        return time12;
    }
    
    const [time, modifier] = time12.split(/\s*(AM|PM)/i);
    let [hours, minutes] = time.split(':');
    
    if (hours === '12') {
        hours = '00';
    }
    
    if (modifier.toUpperCase() === 'PM') {
        hours = parseInt(hours, 10) + 12;
    }
    
    return `${hours.toString().padStart(2, '0')}:${minutes || '00'}`;
}

// Create reminder via API
async function createReminderAPI(title, time, date, description = '') {
    try {
        console.log('Creating reminder via API:', { title, time, date, description });
        showReminderProcessingAnimation();
        
        const response = await fetch('/api/reminders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                title: title,
                time: time,
                date: date,
                description: description
            })
        });
        
        const data = await response.json();
        console.log('Manual reminder creation response:', data);
        
        if (data.reminder) {
            setTimeout(() => {
                removeReminderProcessingAnimation();
                loadReminders().then(() => {
                    console.log('Reminders reloaded after manual creation');
                });
                showNotification('Reminder created successfully!', 'success');
            }, 800);
        } else {
            removeReminderProcessingAnimation();
            showNotification('Error creating reminder', 'error');
        }
    } catch (error) {
        console.error('Error creating reminder:', error);
        removeReminderProcessingAnimation();
        showNotification('Error creating reminder', 'error');
    }
}

// Show helpful reminder format suggestions
function showReminderFormatHelp() {
    showNotification('Try formats like: "Remind me to call John at 3 PM tomorrow" or "Meeting with team Monday at 10 AM"', 'info');
}

// Debug function to check stored reminders
async function debugReminders() {
    try {
        const response = await fetch('/api/debug/reminders');
        const data = await response.json();
        console.log('=== DEBUG: All stored reminders ===');
        console.log(data);
        showNotification(`Found ${data.total_count} total reminders. Check console for details.`, 'info');
    } catch (error) {
        console.error('Error fetching debug data:', error);
    }
}

// View history function (placeholder for future enhancement)
async function viewHistory() {
    // For now, show debug info
    await debugReminders();
}

// Navigation and UI functions
function checkZoomLevel() {
    var zoomLevel = Math.round(window.devicePixelRatio * 100);
    var sidebar = document.getElementById('sidebar');
    var screenWidth = window.innerWidth;
    var mobileDiv = document.getElementById('mobileDiv');

    if (zoomLevel > 400 || screenWidth <= 700) {
        sidebar.classList.add('hide');
        sidebar.classList.remove('collapsed');
        mobileDiv.style.display = 'block';
    } else if (zoomLevel > 300 || screenWidth <= 900) {
        sidebar.classList.add('collapsed');
        mobileDiv.style.display = 'none';
    } else {
        sidebar.classList.remove('collapsed');
        sidebar.classList.remove('hide');
        sidebar.style.display = 'block';
        mobileDiv.style.display = 'none';
    }
}

function toggleSidebar() {
    var sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('collapsed');
}

function startNewChat() {
    sessionId = 'session-' + Date.now();
    var chatContainer = document.querySelector('.chat-container');
    if (chatContainer) {
        // Clear chat messages but keep the welcome message
        var messageContainers = chatContainer.querySelectorAll('.message-container, .error-message, .loading');
        messageContainers.forEach(function(container) {
            container.remove();
        });
    }
    
    fetch('/api/new-chat', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            session_id: sessionId
        })
    })
    .catch(error => {
        console.error('Error starting new chat:', error);
    });
}

// Hash change handler for navigation
window.addEventListener('hashchange', () => {
    const content = document.getElementById('content');
    const hash = window.location.hash.slice(1);
    
    switch(hash) {
        case 'chatBot':
            content.innerHTML = `
                <div class="header">
                    <div class="header-left">remindME</div>
                    <div class="header-right">
                        <button class="share-button" onclick="startNewChat()">
                            <i class="fas fa-plus" style="margin-right: 6px;"></i>New chat
                        </button>
                    </div>
                </div>
                <div class="chat-container" id="chatContainer">
                    <div class="message-container" id="messageContainer"></div>
                </div>
                <div class="div-typing-box-container">
                    <div class="typing-box-container">
                        <div class="flex-Typing-Box">
                            <div class="input-box">
                                <div class="message-Input" id="messageInput" contenteditable="true" data-placeholder="How can I help you today?" onkeydown="if(event.keyCode==13 && !event.shiftKey){sendMessage();return false;}"></div>
                                <button onclick="sendMessage()"><i class="fas fa-arrow-up"></i></button>
                            </div>
                            <div class="div-picture-Button">
                                <button class="picture-Button">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="div-instructions">
                            <p><span class="instructions">remindME can make mistakes. Check important info.</span></p>
                        </div>
                    </div>
                </div>`;
            break;
        case 'explore':
            content.innerHTML = `
                <div class="header">
                    <div class="header-left">Projects</div>
                    <div class="header-right">
                        <button class="share-button"><i class="fas fa-briefcase"></i></button>
                    </div>
                </div>
                <div class="chat-container" id="chatContainer">
                    <div style="text-align: center; margin-top: 120px; padding: 0 40px;">
                        <div class="welcome-greeting">
                            <span class="icon">🚀</span>Projects
                        </div>
                        <p style="color: #b8b8b3; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6;">Organize your work and collaborate with others</p>
                    </div>
                </div>`;
            break;
        case 'imageGenerator':
            content.innerHTML = `
                <div class="header">
                    <div class="header-left">Artifacts</div>
                    <div class="header-right">
                        <button class="share-button"><i class="fas fa-cube"></i></button>
                    </div>
                </div>
                <div class="chat-container">
                    <div style="text-align: center; margin-top: 120px; padding: 0 40px;">
                        <div class="welcome-greeting">
                            <span class="icon">🎨</span>Artifacts
                        </div>
                        <p style="color: #b8b8b3; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6;">Create and edit documents, code, and more</p>
                    </div>
                </div>`;
            break;
        case 'library':
            content.innerHTML = `
                <div class="header">
                    <div class="header-left">Library</div>
                    <div class="header-right">
                        <button class="share-button"><i class="fas fa-bookmark"></i></button>
                    </div>
                </div>
                <div class="chat-container">
                    <div style="text-align: center; margin-top: 120px; padding: 0 40px;">
                        <div class="welcome-greeting">
                            <span class="icon">📚</span>Your Library
                        </div>
                        <p style="color: #b8b8b3; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6;">Your saved chats and bookmarks</p>
                    </div>
                </div>`;
            break;
        default:
            content.innerHTML = `
                <div class="header">
                    <div class="header-left">remindME</div>
                    <div class="header-right">
                        <button class="share-button" onclick="startNewChat()">
                            <i class="fas fa-plus" style="margin-right: 6px;"></i>New chat
                        </button>
                    </div>
                </div>
                <div class="chat-container" id="chatContainer">
                    <div style="text-align: center; margin-top: 120px; padding: 0 40px;">
                        <div class="welcome-greeting">
                            <span class="icon">✨</span>Hello there!
                        </div>
                        <p style="color: #b8b8b3; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6; margin-bottom: 40px;">How can I help you today?</p>
                    </div>
                </div>
                <div class="div-typing-box-container">
                    <div class="typing-box-container">
                        <div class="flex-Typing-Box">
                            <div class="input-box">
                                <div class="message-Input" id="messageInput" contenteditable="true" data-placeholder="How can I help you today?" onkeydown="if(event.keyCode==13 && !event.shiftKey){sendMessage();return false;}"></div>
                                <button onclick="sendMessage()"><i class="fas fa-arrow-up"></i></button>
                            </div>
                            <div class="div-picture-Button">
                                <button class="picture-Button">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="div-instructions">
                            <p><span class="instructions">remindME can make mistakes. Check important info.</span></p>
                        </div>
                    </div>
                </div>`;
    }
});

// Event listeners
window.addEventListener('resize', checkZoomLevel);
window.addEventListener('load', checkZoomLevel);

document.addEventListener('keydown', function(event) {
    if (event.ctrlKey && event.key === '/') { 
        event.preventDefault();
        const messageInput = document.getElementById('messageInput');
        if (messageInput) {
            messageInput.focus();
        }
    }
});

// Load reminders when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadReminders();
    
    // Set up automatic reminder refresh every 5 minutes
    setInterval(loadReminders, 5 * 60 * 1000);
});

// Initial load
if (!window.location.hash) {
    window.location.hash = '#chatBot';
}
window.dispatchEvent(new Event('hashchange'));
</script>
</body>
</html>