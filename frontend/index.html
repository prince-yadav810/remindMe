<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botiverse</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link class="image" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        body { 
            background-color: #1f1e1d;
            color: #e8e8e3;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        .container {
            display: flex;
            height: 100vh;
            flex-direction: row-reverse; /* This moves sidebar to right */
        }

        /* Sidebar - Now on the right */
        .sidebar {
            min-width: 280px;
            background-color: #1f1e1d;
            padding: 16px;
            transition: min-width 0.3s ease;
            position: relative;
            z-index: 2;
            order: 2;
            border-left: 1px solid #3a3a38;
            box-sizing: border-box; /* Ensure consistent width calculation */
        }

        .sidebar.collapsed {
            min-width: 68px;
            transition: min-width 0.3s ease;
        }

        .sidebar.hide {
            min-width: 0px;
            transition: min-width 0.3s ease;
        }

        .sidebar.hoverSidebar {
            position: absolute;
            width: 80px;
            transition: min-width 0.3s ease;
            background-color: #262624;
            top: 0;
            bottom: 0;
            right: 0;
            z-index: 5;
            border-left: 1px solid #3a3a38;
        }

        .sidebar.hoverSidebar-hide {
            width: 0px;
            transition: min-width 0.3s ease;
        }

        /* Updated sidebar-column to cover full width */
        .sidebar-column {
            width: 100%;
            margin-bottom: 16px;
            padding: 0; /* Remove any padding that might cause width issues */
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin-bottom: 24px;
            width: 100%;
            transition: width 0.2s;
            padding: 0; /* Remove padding */
        }

        .sidebar-header h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            color: #e8e8e3;
            font-family: 'Inter', sans-serif;
        }

        .toggle-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 20px;
            margin-right: 18px;
            cursor: pointer;
            transition: opacity 0.3s ease;
            z-index: 10;
            display: block;
            color: #b8b8b3;
        }

        .toggle-btn:hover {
            color: #e8e8e3;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .sidebar ul li {
            margin-bottom: 10px;
            transition: opacity 0.3s ease;
        }

        .sidebar ul li a {
            display: flex;
            align-items: center;
            color: #b8b8b3;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 400;
            margin-bottom: 2px;
        }

        .sidebar ul li a:hover {
            background-color: #3a3a38;
            color: #e8e8e3;
        }

        .sidebar ul li a:active,
        .sidebar ul li a.active {
            background-color: #c96342;
            color: #ffffff;
        }

        .sidebar ul li a i {
            margin-right: 12px;
            font-size: 16px;
            transition: margin-right 0.3s ease;
            width: 16px;
            text-align: center;
        }

        /* Sidebar content styling to ensure full width */
        .sidebar-content {
            width: 100%;
            padding: 0;
            margin: 0;
        }

        /* Time Display Styles - full width */
        .time-display {
            background-color: #2e2421;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            text-align: center;
            width: 100%;
            box-sizing: border-box; /* Ensure padding is included in width */
        }

        .time-display:hover, .reminder-item:hover {
            background-color: #2e2421;
        }

        .current-time {
            font-size: 28px;
            font-weight: 600;
            color: #e8e8e3;
            font-family: 'Inter', sans-serif;
            margin-bottom: 8px;
        }

        .current-date {
            font-size: 14px;
            color: #b8b8b3;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
        }

        /* Reminder Section Styles - full width */
        .reminder-section {
            flex: 1;
            margin-bottom: 20px;
            width: 100%;
            padding: 0; /* Remove any padding */
            box-sizing: border-box; /* Ensure proper width calculation */
        }

        .reminder-title {
            font-size: 16px;
            font-weight: 600;
            color: #e8e8e3;
            margin-bottom: 16px;
            font-family: 'Inter', sans-serif;
        }

        .reminder-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 4px;
        }

        .reminder-list::-webkit-scrollbar {
            width: 4px;
        }

        .reminder-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .reminder-list::-webkit-scrollbar-thumb {
            background: #3a3a38;
            border-radius: 2px;
        }

        .reminder-item {
            background-color: #1f1e1d;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .reminder-item:hover {
            background-color: #2e2421;
            border-color: #4a4a48;
        }

        .reminder-time {
            font-size: 12px;
            color: #c96342;
            font-weight: 500;
            margin-bottom: 4px;
            font-family: 'Inter', sans-serif;
        }

        .reminder-text {
            font-size: 13px;
            color: #e8e8e3;
            line-height: 1.4;
            font-family: 'Inter', sans-serif;
        }

        .no-reminders {
            text-align: center;
            padding: 24px;
            color: #8a8a88;
        }

        .no-reminders i {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        .no-reminders p {
            font-size: 13px;
            margin: 0;
            font-family: 'Inter', sans-serif;
        }

        /* Action Buttons */
        .sidebar-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: absolute;
            bottom: 16px;
            left: 16px;
            right: 16px;
            padding-top: 16px;
            border-top: 1px solid #3a3a38;
        }

        .action-btn {
            background-color: #0f0f0f;
            border: none;
            color: #e8e8e3;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn:hover {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        .action-btn:active {
            background-color: #2a2a2a;
        }

        .action-btn i {
            font-size: 12px;
        }

        /* Collapsed sidebar styles */
        .sidebar.collapsed ul li a i {
            margin-right: 0;
        }

        .sidebar.collapsed ul li a .sidebar-text {
            display: none;
        }

        .sidebar.collapsed .sidebar-content {
            display: none;
        }

        /* Updated collapsed sidebar actions to show icons */
        .sidebar.collapsed .sidebar-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: absolute;
            bottom: 16px;
            left: 8px;
            right: 8px;
            padding-top: 16px;
            border-top: 1px solid #3a3a38;
        }

        .sidebar.collapsed .action-btn {
            background-color: #0f0f0f;
            padding: 12px;
            border-radius: 8px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar.collapsed .action-btn span {
            display: none;
        }

        .sidebar.collapsed .action-btn i {
            font-size: 16px;
            margin: 0;
        }

        .sidebar.collapsed .toggle-btn {
            display: block;
        }

        /* Main Content - Now on the left */
        main {
            flex-grow: 2;
            flex-grow: none;
            overflow: hidden;
            padding: 0px 0px 0px 0px;
            position: relative;
            display: flex;
            flex-direction: column;
            order: 1; /* Ensure main content stays on left */
        }

        .chat-container {
            display: flex;
            position: relative;
            flex-direction: column;
            background-color: #262624;
            margin: 0;
            border-radius: 0;
            margin-bottom: 0px;
            height: 100vh;
            overflow-y: scroll;
            overflow-x: hidden; 
            padding-bottom: 160px; /* Increased padding to prevent overlap with typing box */
            border-right: 1px solid #3a3a38;
        }

        .chat-container.scrollable {
           overflow-y: scroll;
           width: 12px;
        }

        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-track {
            background-color: transparent;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background-color: #3a3a38;
            border-radius: 3px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background-color: #4a4a48;
        }

        .input-box {
            position: relative;
            z-index: 2;
        }

        .chat-window {
            display: flex;
            flex-direction: column;
            background-color: transparent;
            height: 100%;
            overflow-y: hidden;
            align-self: center;
            width: 650px;
            align-items: left;
        }

        .message {
            display: inline-block;
            margin-bottom: 16px;
            font-family: 'Libre Baskerville', Georgia, serif;
            font-size: 14px;
            line-height: 1.6;
            margin-left: 20px;
            margin-right: 20px;
            opacity: 1;
            overflow: hidden;
            color: #e8e8e3;
        }

        .typing-box-container {
            display: flex;
            flex-direction: column;
            z-index: 2;
            justify-content: center;
            justify-self: center;
            justify-items: center;
            align-items: center;
            margin-top: auto;
            align-content: center;
            align-tracks:center;
            align-self: center;
            width: 800px;
            padding: 0 1rem;
            box-sizing: border-box;
            margin-top: calc(0vh - 56px);
            margin-bottom: 20px; /* Added margin to create space from bottom */
            position: fixed;
            bottom: 0;
            max-width: 100%;
            flex-grow: 20%;
            justify-content: space-between;
        }

        .sidebar.collapsed + main .typing-box-container {
            width: calc(100% - 68px);
        }

        .sidebar.hide {
            width: 0px;
            padding: 0px;
        }

        .sidebar.hide ul li a {
            opacity: 0;
        }

        .flex-Typing-Box {
            display: flex;
            padding: 5px;
            width: 100%;
            align-items: center;
            align-self: center;
        }

        .input-box {
            display: flex;
            align-items: flex-end;
            justify-content: right;
            background-color: #1f1e1d;
            padding: 12px 16px;
            border-radius: 12px;
            justify-self: right;
            width: 88%;
            z-index: 2;
            border: 1px solid #3a3a38;
            transition: border-color 0.2s ease;
        }

        .input-box:focus-within {
            border-color: #c96342;
        }

        .sidebar.collapsed .input-box {
            justify-content: flex-end;
            width: calc(10% - 182px);
            margin-left: auto;
        }

        .input-box input {
            flex-grow: 1;
            background-color: transparent;
            border: none;
            outline: none;
            color: #fff;
            padding: 5px;
            font-family: 'Roboto', sans-serif;
            resize: vertical;
            overflow-y: auto;
            max-height: 8em;
            z-index: 2;
        }

        .input-box button {
            background-color: #c96342;
            color: #ffffff;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 14px;
        }

        .input-box button:hover {
            background-color: #b85a3a;
        }

        .input-box button:disabled {
            background-color: #4a4a48;
            color: #8a8a88;
            cursor: not-allowed;
        }

        .input-box button i {
            font-size: 16px;
            z-index: 2;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background-color: #262624;
            position: relative;
            z-index: 2;
            border-bottom: 1px solid #3a3a38;
        }

        .header-left {
            color: #e8e8e3;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            font-family: 'Inter', sans-serif;
        }

        .header-right .share-button {
            background-color: #c96342;
            border: none;
            color: #ffffff;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .header-right .share-button:hover {
            background-color: #b85a3a;
        }

        .message-Input {
          font-size: 18px;
          margin-bottom: 3px;
          margin-left: 3px;
        }

        .div-picture-Button {
            display: flex;
            align-items: middle;
            margin-left: 7px;
            margin-right: 10px;
            z-index: 2;
        }

        .picture-Button {
            border: none;
            color: #b8b8b3;
            background-color: #1f1e1d;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 12px;
            border-radius: 6px;
            height: 48px;
            width: 48px;
            z-index: 2;
            border: 1px solid #3a3a38;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .picture-Button:hover {
            background-color: #3a3a38;
            color: #e8e8e3;
            border-color: #4a4a48;
        }

        .picture-Button:active {
            background-color: #c96342;
            color: #ffffff;
            border-color: #c96342;
        }

        .instructions {
            align-items: center;
            align-self: center;
            font-size: 12px;
            color: #8a8a88;
            display: block;
            z-index: 2;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
        }

        .div-instructions {
            display: block;
            flex-wrap: wrap;
            margin-top: 3px;
            text-align: center;
            z-index: 2;
        }

        .fade-container {
            position: relative;
        }

        .fade-container::before {
            content: "";
            position: absolute;
            left: 0;
            width: 100%;
            height: 160px;
            background: linear-gradient(to top, #1a1a1a 40%, transparent);
            bottom: 0;
            z-index: 1;
        }

        .input-box, .picture-Button {
            position: relative;
            z-index: 2;
        }

        .show-response {
            display:flex;
            flex-direction: column;
        }

        .chat-place {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow:hidden;
            align-self:center;
            width: 700px;
            align-items: left;
            overflow-y: auto;
        }

        .scrollbar {
            display: flex;
            position: absolute;
            top: 0;
            right: 0;
            width: 20px;
            height: 100%;
            background-color: #ccc;
        }

        .additional-content {
            display: flex;
            align-items: center;
            margin-right: 10px;
            display: inline-block;
            object-position: top;
        }

        .logo {
            width: 34px;
            height: 34px;
            margin-right: 0px;
            display: inline-block;
            object-position: top;
            vertical-align:top;
            border-radius: 50px;
        }

        .message-container {
            display: flex;
            position: relative;
            transition: opacity 0.2s;
            flex-direction: row;
            align-items: flex-start;
            margin-bottom: 20px; /* Increased margin between messages */
            align-self:center;
            width: 70%;
            max-width: 700px;
            opacity: 0;
            overflow-wrap: break-word;
        }

        .dropdown-logo {
            display: flex;
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }

        .input-box div[contenteditable] {
            flex-grow: 1;
            background-color: transparent;
            border: none;
            outline: none;
            color: #e8e8e3;
            padding: 8px 12px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            overflow: auto;
            min-height: 20px;
            max-height: 120px;
            z-index: 2;
            word-wrap: break-word;
        }

        .input-box div[contenteditable]:empty::before {
            content: attr(data-placeholder);
            color: #8a8a88;
            pointer-events: none;
            font-style: normal;
        }

        /* Welcome message with Libre Baskerville */
        .welcome-greeting {
            font-family: 'Libre Baskerville', Georgia, serif;
            font-size: 32px;
            font-weight: 400;
            color: #e8e8e3;
            text-align: center;
            margin-bottom: 32px;
        }

        .welcome-greeting .icon {
            color: #c96342;
            margin-right: 16px;
            font-size: 24px;
        }

        .sidebar.collapsed h3 {
            display: none;
            opacity: 0.5;
            transition: opacity 0.18s ease;
        }

        .mobile-container {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 10;
            flex-direction: column;
        }

        .mobileDiv ul {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            justify-content: space-around;
            list-style-type: none;
            padding: 0;
            margin: 0;
            height: 4pc;
        }

        .mobileDiv ul li {
            display: flex;
            flex-direction: column;
            text-align: center;
            justify-self:top;
            justify-content: end; 
        }

        .mobileDiv {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #262624;
            padding: 12px;
            z-index: 10;
            border-top: 1px solid #3a3a38;
        }

        .mobileDiv ul li a {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #b8b8b3;
            text-decoration: none;
            align-items: top;
            align-self: center;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .mobileDiv ul li a i {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .mobileDiv ul li a .sidebar-text {
            font-size: 11px;
            font-weight: 400;
            font-family: 'Inter', sans-serif;
        }

        .mobileDiv ul li a:hover,
        .mobileDiv ul li a.active {
            background-color: #c96342;
            color: #ffffff;
            transform: none;
        }

        .div-typing-box-container {
            display: flex;
            justify-content: center;
            width: 100%;
        }

        /* Loading indicator */
        .loading {
            display: none;
            color: #b8b8b3;
            font-style: normal;
            margin-left: 20px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            padding: 12px 0;
        }

        /* Chat message formatting styles - updated heading sizes */
        .message h3 {
            color: #c96342 !important;
            font-weight: 600 !important;
            margin: 20px 0 12px 0 !important;
            font-size: 18px !important;
            font-family: 'Inter', sans-serif !important;
        }

        .message h4 {
            color: #e8e8e3 !important;
            font-weight: 500 !important;
            margin: 16px 0 8px 0 !important;
            font-size: 16px !important;
            font-family: 'Inter', sans-serif !important;
        }

        .message ul {
            margin: 12px 0 !important;
            padding-left: 20px !important;
            color: #e8e8e3 !important;
        }

        .message li {
            margin: 8px 0 !important;
            line-height: 1.6 !important;
        }

        .message li strong {
            color: #c96342 !important;
            font-weight: 600 !important;
        }

        .message code {
            background-color: #3a3a38 !important;
            padding: 2px 6px !important;
            border-radius: 4px !important;
            font-family: 'JetBrains Mono', monospace !important;
            font-size: 13px !important;
            color: #e8e8e3 !important;
        }

        .message blockquote {
            border-left: 3px solid #c96342 !important;
            padding: 8px 16px !important;
            margin: 8px 0 !important;
            background-color: #2a2a28 !important;
            color: #e8e8e3 !important;
            font-style: italic !important;
        }

        .message em {
            color: #c96342 !important;
            font-style: italic !important;
        }

        /* Formatted sections and special content */
        .message div[style*="background-color: #2a2a28"] {
            background-color: #2a2a28 !important;
            border-left: 3px solid #c96342 !important;
            padding: 12px !important;
            margin: 8px 0 !important;
            border-radius: 4px !important;
            color: #e8e8e3 !important;
        }

        /* Table-like structures */
        .message div[style*="display: flex"] {
            display: flex !important;
            background-color: #2a2a28 !important;
            padding: 8px !important;
            margin: 4px 0 !important;
            border-radius: 4px !important;
        }

        .error-message {
            color: #ff6b6b;
            background-color: #2a1a1a;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 12px 20px;
            border-left: 3px solid #ff6b6b;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }
    </style>
</head>
<body>
<div class="fade-container">
  <div class="container">
      <nav class="sidebar" id="sidebar">
          <!-- Toggle button positioned at top right -->
          <i class="fas fa-bars toggle-btn" onclick="toggleSidebar()"></i>
          
          <div class="sidebar-content">
              <div class="sidebar-column">
                  <div class="sidebar-header">
                      <h3 id="sidebar-header-text">Dashboard</h3>
                  </div>
              </div>
              
              <div class="sidebar-column">
                  <!-- Time Display Section -->
                  <div class="time-display">
                      <div class="current-time" id="currentTime">12:45 PM</div>
                      <div class="current-date" id="currentDate">Monday, Dec 23, 2024</div>
                  </div>
              </div>
              
              <div class="sidebar-column">
                  <!-- Reminder Section -->
                  <div class="reminder-section">
                      <h4 class="reminder-title">Today's Reminders</h4>
                      <div class="reminder-list" id="reminderList">
                          <div class="reminder-item">
                              <div class="reminder-time">2:30 PM</div>
                              <div class="reminder-text">Team meeting with developers</div>
                          </div>
                          <div class="reminder-item">
                              <div class="reminder-time">5:00 PM</div>
                              <div class="reminder-text">Review project documentation</div>
                          </div>
                          <div class="no-reminders" style="display: none;">
                              <i class="fas fa-calendar-check"></i>
                              <p>No reminders for today</p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          
          <!-- Action Buttons at bottom -->
          <div class="sidebar-actions">
              <button class="action-btn" onclick="setReminder()">
                  <i class="fas fa-plus"></i>
                  <span>Set Reminder</span>
              </button>
              <button class="action-btn" onclick="viewHistory()">
                  <i class="fas fa-history"></i>
                  <span>View History</span>
              </button>
          </div>
      </nav>
    <div class="fade-container"></div>

    <main>
        <div id="content">
            <!-- Content will be dynamically loaded here -->
        </div>
        
      <div class="mobileDiv" id="mobileDiv">
        <ul>
          <li><a href="#chatBot"><i class="fas fa-home"></i><span class="sidebar-text">Chat Bots</span></a></li>
              <li><a href="#explore"><i class="fas fa-compass"></i><span class="sidebar-text">Explore</span></a></li>
              <li><a href="#imageGenerator"><i class="fas fa-chart-bar"></i><span class="sidebar-text">Image Generator</span></a></li>
              <li><a href="#library"><i class="fas fa-cog"></i><span class="sidebar-text">Library</span></a></li>
        </ul>
      </div>
     </main> 
  </div>
 </div>

<script>
    // Session management
    let sessionId = 'session-' + Date.now();
    let isLoading = false;

    // Time and Date functionality
    function updateTimeDisplay() {
        const now = new Date();
        
        // Format time (12-hour format with AM/PM)
        const timeOptions = {
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
        };
        const timeString = now.toLocaleTimeString('en-US', timeOptions);
        
        // Format date
        const dateOptions = {
            weekday: 'long',
            month: 'short',
            day: '2-digit',
            year: 'numeric'
        };
        const dateString = now.toLocaleDateString('en-US', dateOptions);
        
        // Update DOM elements
        const timeElement = document.getElementById('currentTime');
        const dateElement = document.getElementById('currentDate');
        
        if (timeElement) timeElement.textContent = timeString;
        if (dateElement) dateElement.textContent = dateString;
    }

    // Update time every second
    setInterval(updateTimeDisplay, 1000);
    updateTimeDisplay(); // Initial call

    // Reminder functionality
    function setReminder() {
        // Simple prompt for now - you can enhance this with a modal later
        const reminderText = prompt("Enter your reminder:");
        const reminderTime = prompt("Enter time (e.g., 3:30 PM):");
        
        if (reminderText && reminderTime) {
            addReminderToList(reminderTime, reminderText);
        }
    }

    function addReminderToList(time, text) {
        const reminderList = document.getElementById('reminderList');
        const noReminders = reminderList.querySelector('.no-reminders');
        
        // Hide "no reminders" message if visible
        if (noReminders && noReminders.style.display !== 'none') {
            noReminders.style.display = 'none';
        }
        
        // Create new reminder item
        const reminderItem = document.createElement('div');
        reminderItem.className = 'reminder-item';
        reminderItem.innerHTML = `
            <div class="reminder-time">${time}</div>
            <div class="reminder-text">${text}</div>
        `;
        
        // Add before the no-reminders div
        if (noReminders) {
            reminderList.insertBefore(reminderItem, noReminders);
        } else {
            reminderList.appendChild(reminderItem);
        }
    }

    function viewHistory() {
        alert("Reminder history functionality coming soon!");
        // You can implement a modal or navigate to a history page here
    }

    function formatBotResponse(text) {
        // Escape HTML to prevent injection
        let formatted = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
        
        // Step 1: Handle bold headings with ** ** - must be at start of line or after whitespace
        formatted = formatted.replace(/(^|\s)\*\*([^*\n]+?)\*\*:?(\s|$)/gm, '$1<h3 style="color: #c96342; font-weight: 600; margin: 20px 0 12px 0; font-size: 18px; font-family: \'Inter\', sans-serif;">$2</h3>$3');
        
        // Step 2: Handle headers with ## and ### - must be at start of line
        formatted = formatted.replace(/^###\s+(.+?)$/gm, '<h4 style="color: #e8e8e3; font-weight: 500; margin: 16px 0 8px 0; font-size: 16px; font-family: \'Inter\', sans-serif;">$1</h4>');
        formatted = formatted.replace(/^##\s+(.+?)$/gm, '<h3 style="color: #c96342; font-weight: 600; margin: 20px 0 12px 0; font-size: 18px; font-family: \'Inter\', sans-serif;">$1</h3>');
        
        // Step 3: Handle bullet points - convert * items to proper list format
        let lines = formatted.split('\n');
        let inList = false;
        let processedLines = [];
        
        for (let i = 0; i < lines.length; i++) {
            let line = lines[i].trim();
            
            // Check if line starts with * followed by space (bullet point)
            if (/^\*\s+/.test(line)) {
                if (!inList) {
                    processedLines.push('<ul style="margin: 12px 0; padding-left: 20px; color: #e8e8e3; list-style-type: disc;">');
                    inList = true;
                }
                // Add list item - remove the * and space
                let listContent = line.substring(2).trim();
                // Handle bold text within list items only
                listContent = listContent.replace(/\*\*([^*]+?)\*\*/g, '<strong style="color: #c96342;">$1</strong>');
                processedLines.push(`<li style="margin: 8px 0; line-height: 1.6; display: list-item;">${listContent}</li>`);
            } else {
                if (inList) {
                    processedLines.push('</ul>');
                    inList = false;
                }
                if (line.length > 0) {
                    processedLines.push(line);
                } else {
                    processedLines.push(''); // Preserve empty lines
                }
            }
        }
        
        // Close any remaining list
        if (inList) {
            processedLines.push('</ul>');
        }
        
        // Join with line breaks to preserve structure
        formatted = processedLines.join('\n');
        
        // Step 4: Handle numbered lists - must be at start of line
        formatted = formatted.replace(/^(\d+\.\s+)(.+?)$/gm, '<div style="margin: 8px 0; color: #e8e8e3;"><span style="color: #c96342; font-weight: 600;">$1</span>$2</div>');
        
        // Step 5: Handle emphasis with single asterisks - but not part of ** or at word boundaries
        formatted = formatted.replace(/(?<!\*)\*([^*\s][^*]*?[^*\s])\*(?!\*)/g, '<em style="color: #c96342; font-style: italic;">$1</em>');
        
        // Step 6: Handle code blocks with backticks - single words or phrases
        formatted = formatted.replace(/`([^`\n]+?)`/g, '<code style="background-color: #3a3a38; padding: 2px 6px; border-radius: 4px; font-family: \'JetBrains Mono\', monospace; font-size: 13px; color: #e8e8e3;">$1</code>');
        
        // Step 7: Handle special sections (bracketed content) - only complete brackets
        formatted = formatted.replace(/\[([^\[\]]+?)\]/g, '<div style="background-color: #2a2a28; border-left: 3px solid #c96342; padding: 12px; margin: 12px 0; border-radius: 4px; color: #e8e8e3;">$1</div>');
        
        // Step 8: Handle quotations - lines starting with >
        formatted = formatted.replace(/^&gt;\s*(.+?)$/gm, '<blockquote style="border-left: 3px solid #c96342; padding: 8px 16px; margin: 12px 0; background-color: #2a2a28; color: #e8e8e3; font-style: italic;">$1</blockquote>');
        
        // Step 9: Handle line breaks properly - minimal BR usage
        formatted = formatted.replace(/\n\s*\n/g, '<br><br>'); // Only double newlines become breaks
        formatted = formatted.replace(/(<\/ul>)\n/g, '$1'); // Remove breaks after lists
        formatted = formatted.replace(/\n(<ul)/g, '$1'); // Remove breaks before lists
        
        // Step 10: Clean up any extra spaces but preserve list structure
        formatted = formatted.replace(/\s*<br>\s*/g, '<br>'); // Clean up breaks
        
        return formatted.trim();
    }

    function sendMessage() {
        var messageInput = document.getElementById('messageInput');
        var messageText = messageInput.textContent.trim();
        
        if (messageText !== '' && !isLoading) {
            isLoading = true;
            var chatContainer = document.querySelector('.chat-container');

            // Log the message text to the console
            console.log(messageText);

            // Create user message
            var message = `<strong>You:</strong><br>${messageText.replace(/\n/g, "<br>")}`;

            // Create a container div for the message
            var messageContainer = document.createElement('div');
            messageContainer.classList.add('message-container');

            // Create a div for the additional content (user avatar)
            var additionalContent = document.createElement('div');
            additionalContent.classList.add('additional-content');

            // Create the logo image (use a default user icon if image not found)
            var logoImg = document.createElement('img');
            logoImg.src = 'Screenshot_2022-01-18-16-24-07-73.jpg';
            logoImg.classList.add('logo');
            logoImg.onerror = function() {
                // If image fails to load, create a text avatar
                var avatar = document.createElement('div');
                avatar.style.cssText = `
                    width: 34px; height: 34px; border-radius: 6px; 
                    background: #3a3a38; color: #e8e8e3; 
                    display: flex; align-items: center; justify-content: center;
                    font-weight: 600; margin-right: 0px; font-size: 14px;
                    font-family: 'Inter', sans-serif;
                `;
                avatar.textContent = 'K';
                additionalContent.replaceChild(avatar, logoImg);
            };

            additionalContent.appendChild(logoImg);
            
            // Create the message div
            var newMessageDiv = document.createElement('div');
            newMessageDiv.classList.add('message');
            newMessageDiv.innerHTML = message;

            // Append elements
            messageContainer.appendChild(additionalContent);
            messageContainer.appendChild(newMessageDiv);
            chatContainer.appendChild(messageContainer);

            // Show message
            setTimeout(function() {
                messageContainer.style.opacity = 1;
            }, 100);

            // Clear input
            messageInput.textContent = '';

            // Show loading indicator
            var loadingDiv = document.createElement('div');
            loadingDiv.classList.add('loading');
            loadingDiv.innerHTML = '<i class="fas fa-circle-notch fa-spin" style="margin-right: 8px; color: #c96342;"></i>Claude is thinking...';
            chatContainer.appendChild(loadingDiv);
            loadingDiv.style.display = 'block';

            // Scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // Send to API
            fetch('/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: messageText,
                    session_id: sessionId
                })
            })
            .then(response => response.json())
            .then(data => {
                // Remove loading indicator
                loadingDiv.remove();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                // Create bot response with formatting
                var formattedResponse = formatBotResponse(data.response);
                var botMessage = `<strong>Bot:</strong><br>${formattedResponse}`;
                
                var botMessageContainer = document.createElement('div');
                botMessageContainer.classList.add('message-container');

                var botAdditionalContent = document.createElement('div');
                botAdditionalContent.classList.add('additional-content');

                // Bot avatar
                var botAvatar = document.createElement('div');
                botAvatar.style.cssText = `
                    width: 34px; height: 34px; border-radius: 6px; 
                    background: #c96342; color: #ffffff;
                    display: flex; align-items: center; justify-content: center;
                    font-weight: bold; margin-right: 0px; font-size: 16px;
                `;
                botAvatar.innerHTML = '<i class="fas fa-robot"></i>';
                botAdditionalContent.appendChild(botAvatar);

                var botMessageDiv = document.createElement('div');
                botMessageDiv.classList.add('message');
                botMessageDiv.innerHTML = botMessage;

                botMessageContainer.appendChild(botAdditionalContent);
                botMessageContainer.appendChild(botMessageDiv);
                chatContainer.appendChild(botMessageContainer);

                // Show bot message
                setTimeout(function() {
                    botMessageContainer.style.opacity = 1;
                }, 100);

                // Scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            })
            .catch(error => {
                // Remove loading indicator
                loadingDiv.remove();
                
                // Show error message
                var errorDiv = document.createElement('div');
                errorDiv.classList.add('error-message');
                errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Error: ${error.message}`;
                chatContainer.appendChild(errorDiv);
                
                console.error('Error:', error);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            })
            .finally(() => {
                isLoading = false;
            });
        }
    }

    function checkZoomLevel() {
        var zoomLevel = Math.round(window.devicePixelRatio * 100);
        var sidebar = document.getElementById('sidebar');
        var header = document.getElementById('header');
        var sidebarHeader = document.getElementById('sidebar-header');
        var screenWidth = window.innerWidth;
        var mobileDiv = document.getElementById('mobileDiv');
        var body = document.body;

        if (zoomLevel > 400 || screenWidth <= 700) {
            sidebar.classList.add('hide');
            sidebar.classList.remove('collapsed');
            mobileDiv.style.display = 'block';
            moveSidebarItemsToSidebar();
        } else if (zoomLevel > 300 || screenWidth <= 900) {
            sidebar.classList.add('collapsed');
            mobileDiv.style.display = 'none';
            moveSidebarItemsToSidebar();
        } else {
            sidebar.classList.remove('collapsed');
            sidebar.classList.remove('hide');
            sidebar.style.display = 'block';
            mobileDiv.style.display = 'none';
            moveSidebarItemsToSidebar();  
        }
    }

    function moveSidebarItemsToSidebar() {
        // Since we removed ul/li structure, we'll handle mobile differently
        // For now, we'll keep the mobile div as is and handle sidebar collapse
        var mobileDiv = document.getElementById('mobileDiv');
        var sidebar = document.getElementById('sidebar');
        
        if (window.innerWidth <= 700) {
            // Hide sidebar content on mobile, show mobile nav
            sidebar.style.display = 'none';
            mobileDiv.style.display = 'block';
        } else {
            // Show sidebar on desktop, hide mobile nav
            sidebar.style.display = 'flex';
            mobileDiv.style.display = 'none';
        }
    }

    window.addEventListener('resize', checkZoomLevel);
    window.addEventListener('load', checkZoomLevel);

    function toggleSidebar() {
        var sidebar = document.getElementById('sidebar');
        var toggleBtn = document.querySelector('.toggle-btn');
        sidebar.classList.toggle('collapsed');
    }

    var toggleBtn = document.querySelector('.toggle-btn');

    document.addEventListener('keydown', function(event) {
        if (event.ctrlKey && event.key === '/') { 
            event.preventDefault();
            const messageInput = document.getElementById('messageInput');
            messageInput.focus();
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        var discoverButton = document.querySelector('.sidebar ul li:nth-child(2) a');
        if (discoverButton) {
            discoverButton.addEventListener('click', function(event) {
                event.preventDefault();
                window.location.href = 'AINews.html';
            });
        }
    }); 

    window.addEventListener('hashchange', () => {
        const content = document.getElementById('content');
        const hash = window.location.hash.slice(1);
        
        switch(hash) {
            case 'chatBot':
                content.innerHTML = `
                    <div class="header">
                        <div class="header-left">Claude</div>
                        <div class="header-right">
                            <button class="share-button" onclick="startNewChat()">
                                <i class="fas fa-plus" style="margin-right: 6px;"></i>New chat
                            </button>
                        </div>
                    </div>
                    <div class="chat-container" id="chatContainer">
                        <div class="message-container" id="messageContainer"></div>
                    </div>
                    <div class="div-typing-box-container">
                        <div class="typing-box-container">
                            <div class="flex-Typing-Box">
                                <div class="input-box">
                                    <div class="message-Input" id="messageInput" contenteditable="true" data-placeholder="How can I help you today?" onkeydown="if(event.keyCode==13 && !event.shiftKey){sendMessage();return false;}"></div>
                                    <button onclick="sendMessage()"><i class="fas fa-arrow-up"></i></button>
                                </div>
                                <div class="div-picture-Button">
                                    <button class="picture-Button">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="div-instructions">
                                <p><span class="instructions">Claude can make mistakes. Check important info.</span></p>
                            </div>
                        </div>
                    </div>`;
                break;
            case 'explore':
                content.innerHTML = `
                    <div class="header">
                        <div class="header-left">Projects</div>
                        <div class="header-right">
                            <button class="share-button"><i class="fas fa-briefcase"></i></button>
                        </div>
                    </div>
                    <div class="chat-container" id="chatContainer">
                        <div style="text-align: center; margin-top: 120px; padding: 0 40px;">
                            <div class="welcome-greeting">
                                <span class="icon">ðŸš€</span>Projects
                            </div>
                            <p style="color: #b8b8b3; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6;">Organize your work and collaborate with others</p>
                        </div>
                    </div>`;
                break;
            case 'imageGenerator':
                content.innerHTML = `
                    <div class="header">
                        <div class="header-left">Artifacts</div>
                        <div class="header-right">
                            <button class="share-button"><i class="fas fa-cube"></i></button>
                        </div>
                    </div>
                    <div class="chat-container">
                        <div style="text-align: center; margin-top: 120px; padding: 0 40px;">
                            <div class="welcome-greeting">
                                <span class="icon">ðŸŽ¨</span>Artifacts
                            </div>
                            <p style="color: #b8b8b3; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6;">Create and edit documents, code, and more</p>
                        </div>
                    </div>`;
                break;
            case 'library':
                content.innerHTML = `
                    <div class="header">
                        <div class="header-left">Library</div>
                        <div class="header-right">
                            <button class="share-button"><i class="fas fa-bookmark"></i></button>
                        </div>
                    </div>
                    <div class="chat-container">
                        <div style="text-align: center; margin-top: 120px; padding: 0 40px;">
                            <div class="welcome-greeting">
                                <span class="icon">ðŸ“š</span>Your Library
                            </div>
                            <p style="color: #b8b8b3; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6;">Your saved chats and bookmarks</p>
                        </div>
                    </div>`;
                break;
            default:
                content.innerHTML = `
                    <div class="header">
                        <div class="header-left">Claude</div>
                        <div class="header-right">
                            <button class="share-button" onclick="startNewChat()">
                                <i class="fas fa-plus" style="margin-right: 6px;"></i>New chat
                            </button>
                        </div>
                    </div>
                    <div class="chat-container" id="chatContainer">
                        <div style="text-align: center; margin-top: 120px; padding: 0 40px;">
                            <div class="welcome-greeting">
                                <span class="icon">âœ¨</span>Good evening, Krishna
                            </div>
                            <p style="color: #b8b8b3; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6; margin-bottom: 40px;">How can I help you today?</p>
                        </div>
                    </div>
                    <div class="div-typing-box-container">
                        <div class="typing-box-container">
                            <div class="flex-Typing-Box">
                                <div class="input-box">
                                    <div class="message-Input" id="messageInput" contenteditable="true" data-placeholder="How can I help you today?" onkeydown="if(event.keyCode==13 && !event.shiftKey){sendMessage();return false;}"></div>
                                    <button onclick="sendMessage()"><i class="fas fa-arrow-up"></i></button>
                                </div>
                                <div class="div-picture-Button">
                                    <button class="picture-Button">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="div-instructions">
                                <p><span class="instructions">Claude can make mistakes. Check important info.</span></p>
                            </div>
                        </div>
                    </div>`;
        }
    });

    function startNewChat() {
        sessionId = 'session-' + Date.now();
        var chatContainer = document.querySelector('.chat-container');
        if (chatContainer) {
            // Clear chat messages but keep the welcome message
            var messageContainers = chatContainer.querySelectorAll('.message-container, .error-message, .loading');
            messageContainers.forEach(function(container) {
                container.remove();
            });
        }
        
        fetch('/api/new-chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                session_id: sessionId
            })
        })
        .catch(error => {
            console.error('Error starting new chat:', error);
        });
    }

    // Initial load
    window.dispatchEvent(new Event('hashchange'));
</script>
</body>
</html>